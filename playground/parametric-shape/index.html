<html>
	<head>
		<title>My first Three.js app</title>
		<style>
			canvas { 
				width: 100%; 
				height: 100% 
			}
		</style>
	</head>
	<body>
		<script src="../../assets/js/three.min.js"></script>
		<script src="../../assets/js/dat.gui.min.js"></script>
		<script src="../../assets/js/SubdivisionModifier.js"></script>
		<script src="../../assets/js/jquery-2.1.1.min.js"></script>
		<link rel="stylesheet" href="../../assets/css/style.css">
		<script>

		var viz;

		$( document )
			.ready(
				function() {

				viz = new emoVIZ();
				document.body.appendChild( viz.renderer.domElement );

				// LIGHT
				//var light = new THREE.AmbientLight( 0x404040 );
				//scene.add(light);

				//RENDER
				function render() {
					requestAnimationFrame( render ); 
					viz.parametricCube.mesh.rotation.y += 0.01;
					viz.parametricCube.mesh.rotation.z += 0.01;
					viz.renderer.render(viz.scene, viz.camera); 
				}

				render();

		});



		var emoVIZ = function()
		{


			this.scene = new THREE.Scene();
			this.camera = new THREE.PerspectiveCamera( 75, $(window).innerWidth() / $(window).innerHeight(), 0.1, 1000);
			this.renderer = new THREE.WebGLRenderer();
			this.renderer.setSize( $(window).innerWidth(), $(window).innerHeight() );

			// ADD CUBE
			var modifier = new THREE.SubdivisionModifier( 2 );

			//var cube = new THREE.Mesh( geometry, material ); 
			//scene.add( cube ); 
			this.camera.position.z = 5;
			this.parametricCube = new ParametricCube();
			this.parametricCube.generateMesh();

			this.directionalLight = new THREE.DirectionalLight( 0xffffff, 0.1 ); 
			this.scene.add( this.parametricCube.mesh );
			this.scene.add( this.directionalLight );

			// parameters for our shape
			this.parameters = {
				  ratio :  0.0, scale : 0.0
			};


			this.gui = new dat.GUI();
			this.ratio = this.gui.add(this.parameters, 'ratio', 0, 10);
			this.scale = this.gui.add(this.parameters, 'scale', 0, 1);

			self = this;

			// this event updates the parametriccube
			this.ratio.onChange(
				function(value) {
					console.log(self.parametricCube);
					self.parametricCube.set(value);
				}
			);


		};



		var ParametricCube = function() {

			self = this;

			this.geometry = new THREE.Geometry();

			this.outerVertices = {
				bottom : [
					// bottom
					new THREE.Vector3(0,0,0),
					new THREE.Vector3(0,0,1),
					new THREE.Vector3(1,0,1),
					new THREE.Vector3(1,0,0)
				], 
				top : [
					// top
					new THREE.Vector3(0,1,0),
					new THREE.Vector3(0,1,1),
					new THREE.Vector3(1,1,1),
					new THREE.Vector3(1,1,0)
				]
			};


			this.centroids = {
				front 	: new THREE.Vector3(0.5,0.5,0),
				back 	: new THREE.Vector3(0.5,0.5,1),
				left 	: new THREE.Vector3(0,0.5,0.5),
				right 	: new THREE.Vector3(1,0.5,0.5),
				top 	: new THREE.Vector3(0.5,1,0.5),
				bottom 	: new THREE.Vector3(0.5,0,0.5)
			};

			this.innerVertices = { front : [],  back : [],  left : [],  right : [],  top : [],  bottom : [] };

			this.innerVertices.front.push( { v : this.centroids.front.clone(), id : 0 } ); 							     this.geometry.vertices.push( this.innerVertices.front[0].v ); 
			this.innerVertices.front.push( { v : this.centroids.front.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.front[1].v ); 
			this.innerVertices.front.push( { v : this.centroids.front.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.front[2].v ); 
			this.innerVertices.front.push( { v : this.centroids.front.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.front[3].v ); 

			this.innerVertices.back.push( {v : this.centroids.back.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.back[0].v );
			this.innerVertices.back.push( {v : this.centroids.back.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.back[1].v );
			this.innerVertices.back.push( {v : this.centroids.back.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.back[2].v );
			this.innerVertices.back.push( {v : this.centroids.back.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.back[3].v );

			this.innerVertices.left.push( {v : this.centroids.left.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.left[0].v );
			this.innerVertices.left.push( {v : this.centroids.left.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.left[1].v );
			this.innerVertices.left.push( {v : this.centroids.left.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.left[2].v );
			this.innerVertices.left.push( {v : this.centroids.left.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.left[3].v );

			this.innerVertices.right.push( {v : this.centroids.right.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.right[0].v );
			this.innerVertices.right.push( {v : this.centroids.right.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.right[1].v );
			this.innerVertices.right.push( {v : this.centroids.right.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.right[2].v );
			this.innerVertices.right.push( {v : this.centroids.right.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.right[3].v );

			this.innerVertices.top.push( {v : this.centroids.top.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.top[0].v );
			this.innerVertices.top.push( {v : this.centroids.top.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.top[1].v );
			this.innerVertices.top.push( {v : this.centroids.top.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.top[2].v );
			this.innerVertices.top.push( {v : this.centroids.top.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.top[3].v );

			this.innerVertices.bottom.push( {v : this.centroids.bottom.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.bottom[0].v );
			this.innerVertices.bottom.push( {v : this.centroids.bottom.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.bottom[1].v );
			this.innerVertices.bottom.push( {v : this.centroids.bottom.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.bottom[2].v );
			this.innerVertices.bottom.push( {v : this.centroids.bottom.clone(), id : this.geometry.vertices.length } ); this.geometry.vertices.push( this.innerVertices.bottom[3].v );


			this.geometry.faces.push( new THREE.Face3( this.innerVertices.front[0].id, this.innerVertices.front[1].id, this.innerVertices.front[2].id) );
			this.geometry.faces.push( new THREE.Face3( this.innerVertices.front[2].id, this.innerVertices.front[3].id, this.innerVertices.front[0].id) );

			this.geometry.faces.push( new THREE.Face3( this.innerVertices.back[0].id, this.innerVertices.back[1].id, this.innerVertices.back[2].id) );
			this.geometry.faces.push( new THREE.Face3( this.innerVertices.back[2].id, this.innerVertices.back[3].id, this.innerVertices.back[0].id) );

			this.geometry.faces.push( new THREE.Face3( this.innerVertices.top[0].id, this.innerVertices.top[1].id, this.innerVertices.top[2].id) );
			this.geometry.faces.push( new THREE.Face3( this.innerVertices.top[2].id, this.innerVertices.top[3].id, this.innerVertices.top[0].id) );

			this.geometry.faces.push( new THREE.Face3( this.innerVertices.bottom[0].id, this.innerVertices.bottom[1].id, this.innerVertices.bottom[2].id) );
			this.geometry.faces.push( new THREE.Face3( this.innerVertices.bottom[2].id, this.innerVertices.bottom[3].id, this.innerVertices.bottom[0].id) );

			this.geometry.faces.push( new THREE.Face3( this.innerVertices.left[0].id, this.innerVertices.left[1].id, this.innerVertices.left[2].id) );
			this.geometry.faces.push( new THREE.Face3( this.innerVertices.left[2].id, this.innerVertices.left[3].id, this.innerVertices.left[0].id) );

			this.geometry.faces.push( new THREE.Face3( this.innerVertices.right[0].id, this.innerVertices.right[1].id, this.innerVertices.right[2].id) );
			this.geometry.faces.push( new THREE.Face3( this.innerVertices.right[2].id, this.innerVertices.right[3].id, this.innerVertices.right[0].id) );



			// 0 = centroid, 1 = outerVertice
			this.set = function( amount ) {

				/* 
				vertice-index as seen from orthogonal 'above'
					1----2
					| \  |
					|  \ |
					0----3
				*/

				// front
				console.log(this.innerVertices.front[0].v);
				this.innerVertices.front[0].v.copy(this.centroids.front.clone().lerp( this.outerVertices.bottom[0], amount));
				this.innerVertices.front[1].v.copy(this.centroids.front.clone().lerp( this.outerVertices.top[0], amount));
				this.innerVertices.front[2].v.copy(this.centroids.front.clone().lerp( this.outerVertices.top[3], amount));
				this.innerVertices.front[3].v.copy(this.centroids.front.clone().lerp( this.outerVertices.bottom[3], amount));
				
				// back
				this.innerVertices.back[0].v.copy(this.centroids.back.clone().lerp( this.outerVertices.bottom[2], amount));
				this.innerVertices.back[1].v.copy(this.centroids.back.clone().lerp( this.outerVertices.top[2], amount));
				this.innerVertices.back[2].v.copy(this.centroids.back.clone().lerp( this.outerVertices.top[1], amount));
				this.innerVertices.back[3].v.copy(this.centroids.back.clone().lerp( this.outerVertices.bottom[1], amount));

				// left
				this.innerVertices.left[0].v.copy(this.centroids.left.clone().lerp( this.outerVertices.bottom[1], amount));
				this.innerVertices.left[1].v.copy(this.centroids.left.clone().lerp( this.outerVertices.top[1], amount));
				this.innerVertices.left[2].v.copy(this.centroids.left.clone().lerp( this.outerVertices.top[0], amount));
				this.innerVertices.left[3].v.copy(this.centroids.left.clone().lerp( this.outerVertices.bottom[0], amount));


				// right
				this.innerVertices.right[0].v.copy(this.centroids.right.clone().lerp( this.outerVertices.bottom[3], amount));
				this.innerVertices.right[1].v.copy(this.centroids.right.clone().lerp( this.outerVertices.top[3], amount));
				this.innerVertices.right[2].v.copy(this.centroids.right.clone().lerp( this.outerVertices.top[2], amount));
				this.innerVertices.right[3].v.copy(this.centroids.right.clone().lerp( this.outerVertices.bottom[2], amount));

				// top
				this.innerVertices.top[0].v.copy(this.centroids.top.clone().lerp( this.outerVertices.top[0], amount));
				this.innerVertices.top[1].v.copy(this.centroids.top.clone().lerp( this.outerVertices.top[1], amount));
				this.innerVertices.top[2].v.copy(this.centroids.top.clone().lerp( this.outerVertices.top[2], amount));
				this.innerVertices.top[3].v.copy(this.centroids.top.clone().lerp( this.outerVertices.top[3], amount));

				// bottom
				this.innerVertices.bottom[0].v.copy(this.centroids.bottom.clone().lerp( this.outerVertices.bottom[0], amount));
				this.innerVertices.bottom[1].v.copy(this.centroids.bottom.clone().lerp( this.outerVertices.bottom[1], amount));
				this.innerVertices.bottom[2].v.copy(this.centroids.bottom.clone().lerp( this.outerVertices.bottom[2], amount));
				this.innerVertices.bottom[3].v.copy(this.centroids.bottom.clone().lerp( this.outerVertices.bottom[3], amount));

				this.geometry.verticesNeedUpdate = true;

			};

			this.generateMesh = function () {

				this.material = new THREE.MeshBasicMaterial({ 
					wireframe: true
				});

				this.mesh = new THREE.Mesh( this.geometry, this.material);
			};
		};
		</script>
	</body>
</html>